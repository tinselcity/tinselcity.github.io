---
layout: post
title: Indexing 1M IP addresses in memory
---

A common use-case to support in a CDN is the ability for customers to specify lists of IP's they'd like to block from accessing their content, an "IP Blacklist".  If the address were just plain IPv4/IPv6 lists it'd be simple enough to just index with a standard data structure with sorting, eg a hash map, or a sorted tree.

```cpp
#include <stdio.h>
#include <set>
#include <string>
int main(void)
{
        typedef std::set<std::string> ip_set_t;
        ip_set_t l_ip_set;
        // -------------------------------------------------
        // populate
        // -------------------------------------------------
        l_ip_set.insert("127.0.0.1");
        l_ip_set.insert("1.2.3.4");
        // -------------------------------------------------
        // search
        // -------------------------------------------------
        if(l_ip_set.find("1.2.3.4") != l_ip_set.end())
        {
                printf("found it!\n");
        }
        return 0;
}
```
easy peasy right??? :)

The rub is having to deal with [cidr](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing) support -addresses specified with ranges like: `192.168.100.0/22 `

